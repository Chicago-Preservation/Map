<script>
    // Function to ensure dropdown is visible on page load
    $(document).ready(function() {
        $('.dropdown-content').css("display", 'block'); // Set dropdown to open by default
    });

    function circletoggle() {
        if ($('.circle-content').css("height") == '0px') {
            $('.circle-content').css("height", '{{site.menu-height}}');
            $('.circle-content').css("width", '{{site.menu-width}}');
            $('.circle-content').css("opacity", '{{site.menu-opacity}}');
            $('.menu-button').css("display", "none");
        } else {
            $('.circle-content').css("height", '0px');
            $('.circle-content').css("width", '0px');
            $('.circle-content').css("opacity", '0');
            $('.menu-button').css("display", "inline-block");
        }
    }

    function dropdowntoggle() {
        if ($('.dropdown-content').css("display") == 'none') {
            $('.dropdown-content').css("display", 'block');
        } else {
            $('.dropdown-content').css("display", 'none');
        }
    }

    // Toggle Map Layers Visibility
    document.addEventListener("DOMContentLoaded", function() {
        const mapLayersCheckbox = document.getElementById("toggle-map");
        const sidebarCheckbox = document.getElementById("toggle-sidebar");
        const mapLayersControl = document.querySelector('.leaflet-control-layers');
        const sidebar = document.querySelector('.sidebar');

        // Update visibility based on screen size and toggle state
        function updateVisibility() {
            if (window.innerWidth <= 768) {
                // Mobile view - controlled by checkbox
                if (sidebar) {
                    sidebar.style.display = sidebarCheckbox.checked ? "block" : "none";
                }
                if (mapLayersControl) {
                    mapLayersControl.style.display = mapLayersCheckbox.checked ? "block" : "none";
                }
            } else {
                // Desktop view - always visible
                if (sidebar) {
                    sidebar.style.display = "block";
                }
                if (mapLayersControl) {
                    mapLayersControl.style.display = "block";
                }
            }
        }

        // Event listeners for sidebar and map layer toggle
        if (sidebarCheckbox) {
            sidebarCheckbox.addEventListener("change", updateVisibility);
        }
        if (mapLayersCheckbox) {
            mapLayersCheckbox.addEventListener("change", updateVisibility);
        }

        // Update on page load and screen resize
        updateVisibility();
        window.addEventListener("resize", updateVisibility);
    });

    // Load page content without a full page reload
    function loadPage(event, url) {
        if (event) event.preventDefault();
        console.log("Loading page:", url);

        let contentDiv = document.getElementById("page-content");
        if (!contentDiv) {
            console.error("Error: Page content div not found.");
            return;
        }

        // Check if the user clicked "Home"
        if (url.includes("#/home")) {
            console.log("Home button clicked. Loading home content...");
            fetch("{{site.baseurl}}/home.html")
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(html => {
                    console.log("Home page loaded successfully!");
                    contentDiv.innerHTML = html;
                    window.location.hash = "/home";
                })
                .catch(error => console.error("Error loading home page:", error));

            return;
        }

        // Default behavior for other pages
        fetch(url)
            .then(response => response.text())
            .then(html => {
                console.log("Page loaded successfully!");
                contentDiv.innerHTML = html;
                history.pushState(null, '', url);
            })
            .catch(error => console.error("Error loading page:", error));
    }
</script>
