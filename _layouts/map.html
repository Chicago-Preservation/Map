<!DOCTYPE html> 
<html>

  {% include head.html %}

  <body>

    {% include sidebar.html %}
       <script>
        window.onload = function(){
          if (localStorage['selectedtem'] != undefined){
            new_map();
          } else {
            new_map('{{site.marker-grouping}}');
          }
          reloadhtml();
        };
        window.onhashchange = function() {
          reloadhtml();
        };
       </script>

    <div id="map" style="width: 100%; height: 600px;"></div>

    <script>

    // Initialize the Leaflet map
    var map = L.map('map', {scrollWheelZoom: false}).setView([41.8781, -87.6298], 12); // Center on Chicago

    // Base map layer (ESRI Gray Light)
    L.tileLayer('{{site.map-tileset}}', {
      attribution : '{{site.map-credits}}',
      minZoom : {{site.minZoom}},
      maxZoom : {{site.maxZoom}},
      errorTileUrl : "img/error-tile-image.png",
      subdomains : ["a", "b", "c", "d"],
      detectRetina : true,
    }).addTo(map);

    // Adding NR Properties GeoJSON Layer
    var nrPropertiesLayer = L.geoJSON(null, {
      onEachFeature: function (feature, layer) {
        var popupContent = '<strong>' + 
          (feature.properties.SignificantName || 'No Name') + 
          '</strong><br>' +
          '<em>Location:</em> ' + (feature.properties.Location || 'Unknown') + '<br>' +
          '<em>Architect:</em> ' + (feature.properties.Architect || 'Unknown') + '<br>' +
          '<em>Begin Year:</em> ' + (feature.properties.BeginYear || 'Unknown') + '<br>' +
          '<em>End Year:</em> ' + (feature.properties.EndYear || 'Unknown');
        layer.bindPopup(popupContent);
      },
      style: function (feature) {
        return {
          color: "#3388ff",
          weight: 2,
          fillOpacity: 0.6
        };
      }
    });

    fetch('https://Chicago-Preservation.github.io/Map/NR_Properties_filtered.geojson')
      .then(response => response.json())
      .then(data => {
        nrPropertiesLayer.addData(data);
      })
      .catch(error => console.error('Error loading NR Properties GeoJSON:', error));

    // Adding Landmarks GeoJSON Layer
    var landmarksLayer = L.geoJSON(null, {
      onEachFeature: function (feature, layer) {
        var popupContent = '<strong>' + (feature.properties.NAME || 'Unknown') + '</strong><br>' +
                           '<em>Architect:</em> ' + (feature.properties.ARCHITECT || 'Unknown') + '<br>' +
                           '<em>Address:</em> ' + (feature.properties.ADDRESS || 'Unknown') + '<br>' +
                           '<em>Date Built:</em> ' + (feature.properties.DATE_BUILT || 'Unknown');
        layer.bindPopup(popupContent);
      }
    });

    fetch('https://Chicago-Preservation.github.io/Map/landmarkareas.geojson')
      .then(response => response.json())
      .then(data => {
        landmarksLayer.addData(data);
      });

    // Adding Community Boundaries GeoJSON Layer
    var boundariesLayer = L.geoJSON(null, {
      style: function (feature) {
        return {
          color: "#000000",
          weight: 2,
          fillOpacity: 0
        };
      },
      onEachFeature: function (feature, layer) {
        var center = layer.getBounds().getCenter();
        var communityName = feature.properties.community || 'Unknown';
        var formattedCommunityName = communityName.split(' ').join('<br>');
        var communityLabel = L.divIcon({
          className: 'community-label',
          html: '<div>' + formattedCommunityName + '</div>',
          iconSize: [100, 20]
        });
        L.marker(center, { icon: communityLabel }).addTo(map);
      }
    });

    fetch('https://Chicago-Preservation.github.io/Map/boundaries.geojson')
      .then(response => response.json())
      .then(data => {
        boundariesLayer.addData(data);
      });

    // Layer control for toggling visibility of layers
    var overlayMaps = {
      "NR Properties": nrPropertiesLayer,
      "Landmarks": landmarksLayer,
      "Community Boundaries": boundariesLayer
    };

    L.control.layers(null, overlayMaps, { collapsed: false, position: 'topright' }).addTo(map);

    </script>

    {% include menu.html %}
    {% include dropdown.html %}
  </body>
</html>
